<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/bootstrap.css">
    <script src="jquery-3.3.1.js"></script>
    <script src="js/bootstrap.js"> </script>
    <script src="jquery.csv.js"></script>
</head>
<body class="container" style="margin-top: 5px">
    <div class="jumbotron">
        <h2 style="text-align: center">
            STUDENT FORM
        </h2>
    </div>
    <form class="form-horizontal">
        <div class="form-group">
            <label for="inputRollNo" class="col-sm-2 control-label">Enter Roll No</label>
            <div class="col-sm-10">
                <input type="number" class="form-control" id="inputRollNo" placeholder="Enter Roll No">
            </div>
        </div>
        <div class="form-group">
            <label for="inputName" class="col-sm-2 control-label">Enter Name</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="inputName" placeholder="Enter Name">
            </div>
        </div>
        <div class="form-group">
            <label for="inputAge" class="col-sm-2 control-label">Enter Age</label>
            <div class="col-sm-10">
              <input type="number" class="form-control" id="inputAge" placeholder="Enter Age">
            </div>
        </div>
        <div class="form-group">
            <label for="inputEmail" class="col-sm-2 control-label">Enter Email Id</label>
            <div class="col-sm-10">
              <input type="email" class="form-control" id="inputEmail" placeholder="Enter Email Id">
            </div>
        </div>
        <div class="form-group">
            <label for="inputDate" class="col-sm-2 control-label">Enter Date</label>
            <div class="col-sm-10">
              <input type="date" class="form-control" id="inputDate" placeholder="Enter Date">
            </div>
        </div>
        <div class="form-group">
            <label>
                <input type="radio" style="margin-left: 210px" name="optionsRadios" id="gender" value="option1" checked>
                MALE
            </label>
        </div>
        <div class="form-group">
            <label>
                <input type="radio" style="margin-left: 210px" name="optionsRadios" id="gender" value="option2">
                FEMALE
            </label>
        </div>
        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
                <button type="button" id="addButton" class="btn btn-primary" >Add</button>
                <a href="#printData" class="btn btn-primary" id="displayButton">Display</a>
            </div>
        </div>
       
    </form>
    <div id="printData">
            <img id="loading-image" src="colourfulimage.gif" alt="Loading..." />
    </div>
    <script>
        $("#displayButton").on("click",function(){
           DisplayData();
        })

        function DisplayData(){
            $('#loading-image').show();
            $.ajax({
                url: 'http://gsmktg.azurewebsites.net/api/v1/techlabs/test/students/',
                type: 'get',
                success: function (data) {
                    $('#loading-image').hide();
                    getData(data);

                },error:function(){
                    $('#loading-image').hide();
                    $("#printData").html("Data Can't be fetched")
                }
            })
        }

        $("#addButton").click(function(){
            if(validator()){
                $('#loading-image').show();
                $.post("http://gsmktg.azurewebsites.net/api/v1/techlabs/test/students/",
                {
                    "rollNo": $("#inputRollNo").val(),
                    "name": $("#inputName").val(),
                    "age": $("#inputAge").val(),
                    "email": $("#inputEmail").val(),
                    "date": $("#inputDate").val(),                                
                    "isMale": $('#gender').prop('checked')
                },
                function(data,status){
                $('#loading-image').hide();
                alert("Data: " + data + "\nStatus: " + status);
                });
                setTimeout(function(){location.reload()},1000);
            }else{
                alert("Please fill every feild");
                
            }
        });
        function validator(){
            if($("#inputRollNo").val() == "" || $("#inputName").val() == "" || $("#inputAge").val() == "" ||
            $("#inputEmail").val() == "" || $("#inputDate").val() == ""){
                return false;
            }else{
                return true;
            }
        }

        function getData(data){
            var result = data;
            var string;
            string = "<h2>Student Data</h2><table class='table table-hover'>";
            string += "<th>Roll Number</th><th>Student name</th> <th>Age </th> <th>Date</th> <th>Email ID</th> <th>gender</th> <th> Delete Data</th> <th> Edit Data</th>";
            for (var i = 0; i < result.length; i++) {
                var rollNumber = result[i].rollNo;
                var name = result[i].name;
                var age = result[i].age;
                var date = result[i].date;
                var email = result[i].email;
                var gender;
                if(result[i].isMale){
                    gender = "Male"
                }else{
                    gender = "Female"
                }
                string += '<tr>';
                string += "<td>" + rollNumber + "</td>";
                string += "<td>" + name + "</td>";
                string += "<td>" + age + "</td>";
                string += "<td>" + date + "</td>";
                string += "<td>" + email + "</td>";
                string += "<td>" + gender + "</td>";
                string += "<td>" +"<input type='button' id='deleteButton' value='Delete' class='btn btn-danger'>"+"</td>";
                string += "<td>" +"<input type='button' id='editButton' value='Edit' class='btn btn-primary'>"+
                "<span  id='right' class='glyphicon glyphicon-ok btn btn-default ' style='color:green' aria-hidden='true'></span><span class='glyphicon"+
                " glyphicon-remove btn btn-default' id='cancel' style='color:red' aria-hidden='true'></span></td>"+"</td>";
                string += "</tr>";
            }
            string += "</table>";
            $("#printData").html(string);
        }
        

        $(document).on('click','#deleteButton',(function(){
            var ans = confirm("Do You Want To DELETE")
            if(ans){
                var del_id= $(this).parent().siblings(":first").text();
                $.ajax({
                    url: "http://gsmktg.azurewebsites.net/api/v1/techlabs/test/students/"+del_id,
                    type : "DELETE" ,
                    success : function(status){
                        alert(status+"Data DELETED");
                        DisplayData();
                    },
                    error:function(){
                        alert("Problem Occured During OPeration");
                    }
                });
                return;
            }else{
               return;
        };
        }));

        $(document).on('click','#editButton',(function(){
            $('#loading-image').show();
            var del_id= $(this).parent().siblings(":first").text();
            console.log(del_id);
            $('#editButton').hide();
            $('#cancel').show();
            $('#right').show();
            
            $.ajax({
                url: 'http://gsmktg.azurewebsites.net/api/v1/techlabs/test/students/'+del_id,
                type: 'get',
                success: function (data) {
                    console.log(data.isMale)
                    $('#loading-image').hide();
                    $("#inputRollNo").val(data.rollNo);
                    $("#inputName").val(data.name);
                    $("#inputAge").val(data.age);
                    $("#inputEmail").val(data.email);
                    $("#inputDate").val(data.date);
                    $("#gender").prop(data.isMale);
                },error:function(){
                    $('#loading-image').hide();
                    $("#printData").html("Data Can't be fetched")
                }
            })
        }))    

        $(document).ready(function(){
            $('#loading-image').hide();
            $('#cancel').hide();
            $('#right').hide();
        });
            
    </script>
      
</body>
</html>